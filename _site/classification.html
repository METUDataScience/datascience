<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Classification and Error Measurements</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Introduction to Data Science</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="installation.html">R/RStudio Installation</a>
    </li>
    <li>
      <a href="azure_notebooks.html">Azure Notebooks</a>
    </li>
    <li>
      <a href="intro_to_r.html">Introduction to R</a>
    </li>
    <li>
      <a href="amelia.html">Missing Data Imputation</a>
    </li>
    <li>
      <a href="associationMining.html">Association Mining</a>
    </li>
    <li>
      <a href="classification.html">Classification</a>
    </li>
    <li>
      <a href="regression.html">Regression Analysis</a>
    </li>
    <li>
      <a href="timeSeries.html">Time Series Analysis</a>
    </li>
    <li>
      <a href="visualization.html">Visualization</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://mehmetaliakyol.com">
    <span class="fa fa-question fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Classification and Error Measurements</h1>

</div>


<p><strong>Objectives</strong>:</p>
<p>The objective of this document is to give a brief introduction to classification methods and model evaluation. After completing this tutorial you will be able to:</p>
<ul>
<li>Generate classification models</li>
<li>Calculate accuracy, sensitivity and specificity values</li>
<li>Evaluate model performance</li>
<li>Calculate AUC</li>
</ul>
<p>Let’s load the data:</p>
<pre class="r"><code>data(iris) 
head(iris)</code></pre>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1          5.1         3.5          1.4         0.2  setosa
## 2          4.9         3.0          1.4         0.2  setosa
## 3          4.7         3.2          1.3         0.2  setosa
## 4          4.6         3.1          1.5         0.2  setosa
## 5          5.0         3.6          1.4         0.2  setosa
## 6          5.4         3.9          1.7         0.4  setosa</code></pre>
<pre class="r"><code>shuffleIris &lt;- iris[sample(nrow(iris)),] #Shuffle the dataset 
trainIris &lt;- shuffleIris[1:100,] #Subset the training set 
testIris &lt;- shuffleIris[101:150,-5] #Subset the test set without the class column 
testClass &lt;- shuffleIris[101:150,5] #Get test classes into a separate vector</code></pre>
<div id="k-nearest-neighbors-classification" class="section level2">
<h2>k-Nearest Neighbors Classification</h2>
<pre class="r"><code>require(class)
predClass &lt;- knn(trainIris[,-5],testIris, trainIris[,5], k = 5) #knn(trainvariables, testvariables, trainclasses, k)
require(caret)
confusionMatrix(testClass, predClass)</code></pre>
<pre><code>## Confusion Matrix and Statistics
## 
##             Reference
## Prediction   setosa versicolor virginica
##   setosa         20          0         0
##   versicolor      0         12         0
##   virginica       0          1        17
## 
## Overall Statistics
##                                           
##                Accuracy : 0.98            
##                  95% CI : (0.8935, 0.9995)
##     No Information Rate : 0.4             
##     P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
##                                           
##                   Kappa : 0.9695          
##                                           
##  Mcnemar&#39;s Test P-Value : NA              
## 
## Statistics by Class:
## 
##                      Class: setosa Class: versicolor Class: virginica
## Sensitivity                    1.0            0.9231           1.0000
## Specificity                    1.0            1.0000           0.9697
## Pos Pred Value                 1.0            1.0000           0.9444
## Neg Pred Value                 1.0            0.9737           1.0000
## Prevalence                     0.4            0.2600           0.3400
## Detection Rate                 0.4            0.2400           0.3400
## Detection Prevalence           0.4            0.2400           0.3600
## Balanced Accuracy              1.0            0.9615           0.9848</code></pre>
<p>This has a pretty high accuracy. This is partly due to how clean our data is.</p>
<p>The confusion matrix gives us a table that tells the overlap between true class and the predicted class. The columns give us the true class while the rows give us the predicted ones. Take a look at the <code>virginica</code> column in the confusion matrix. One instance of data that is actually <code>virginica</code> is classified as <code>versicolor</code>. Confusion matrix gives us information about the confusion of the classes by the model.</p>
</div>
<div id="naive-bayes-classification" class="section level2">
<h2>Naive Bayes Classification</h2>
<pre class="r"><code>require(e1071)
naiveModel &lt;- naiveBayes(Species~., data = trainIris) 
predClass &lt;- predict(naiveModel, testIris) 
confusionMatrix(testClass, predClass)</code></pre>
<pre><code>## Confusion Matrix and Statistics
## 
##             Reference
## Prediction   setosa versicolor virginica
##   setosa         20          0         0
##   versicolor      0         12         0
##   virginica       0          1        17
## 
## Overall Statistics
##                                           
##                Accuracy : 0.98            
##                  95% CI : (0.8935, 0.9995)
##     No Information Rate : 0.4             
##     P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
##                                           
##                   Kappa : 0.9695          
##                                           
##  Mcnemar&#39;s Test P-Value : NA              
## 
## Statistics by Class:
## 
##                      Class: setosa Class: versicolor Class: virginica
## Sensitivity                    1.0            0.9231           1.0000
## Specificity                    1.0            1.0000           0.9697
## Pos Pred Value                 1.0            1.0000           0.9444
## Neg Pred Value                 1.0            0.9737           1.0000
## Prevalence                     0.4            0.2600           0.3400
## Detection Rate                 0.4            0.2400           0.3400
## Detection Prevalence           0.4            0.2400           0.3600
## Balanced Accuracy              1.0            0.9615           0.9848</code></pre>
<p>This also has a pretty high accuracy.</p>
</div>
<div id="decision-trees" class="section level2">
<h2>Decision Trees</h2>
<pre class="r"><code>require(rpart)
decisionModel &lt;- rpart(Species~., data = trainIris) 
predClass &lt;- predict(decisionModel, testIris, type = &quot;class&quot;) 
confusionMatrix(testClass, predClass)</code></pre>
<pre><code>## Confusion Matrix and Statistics
## 
##             Reference
## Prediction   setosa versicolor virginica
##   setosa         20          0         0
##   versicolor      0         12         0
##   virginica       0          2        16
## 
## Overall Statistics
##                                           
##                Accuracy : 0.96            
##                  95% CI : (0.8629, 0.9951)
##     No Information Rate : 0.4             
##     P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
##                                           
##                   Kappa : 0.9392          
##                                           
##  Mcnemar&#39;s Test P-Value : NA              
## 
## Statistics by Class:
## 
##                      Class: setosa Class: versicolor Class: virginica
## Sensitivity                    1.0            0.8571           1.0000
## Specificity                    1.0            1.0000           0.9412
## Pos Pred Value                 1.0            1.0000           0.8889
## Neg Pred Value                 1.0            0.9474           1.0000
## Prevalence                     0.4            0.2800           0.3200
## Detection Rate                 0.4            0.2400           0.3200
## Detection Prevalence           0.4            0.2400           0.3600
## Balanced Accuracy              1.0            0.9286           0.9706</code></pre>
<pre class="r"><code>require(rpart.plot)
prp(decisionModel) </code></pre>
<p><img src="classification_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Keep in mind that due to sampling your decision tree can look different than this.</p>
<p>This also has a very high accuracy; however, accuracy in itself is not sufficient in evaluating models. We should also consider the specificity and sensitivity values. Because, if there is an imbalance in the class, say you have 1000 <code>class A</code> in your test data and 10 <code>class B</code>. Then, if you label all the test data as <code>class A</code>, you will have high accuracy (1000/1010), however you weren’t able to detect any instances with <code>class B</code>, so your model is not very good. Sensitivity and Specificity both needs to be high for your model to be good.</p>
</div>
<div id="logistic-regression" class="section level2">
<h2>Logistic Regression</h2>
<p>Logistic regression is the type of regression where you fit a binary classification model. A binary classification model is the type of model where your output variable has 2 classes. Now this doesn?t mean that if you have a data that has more than one class (such as the iris data) cannot be modeled using a logistic regression. The idea is that you model each class vs. all others individually.</p>
<p>Let’s load the data:</p>
<pre class="r"><code>data &lt;- read.csv(url(&quot;http://archive.ics.uci.edu/ml/machine-learning-databases/cmc/cmc.data&quot;), sep=&quot;,&quot;, header = F) 
names(data) &lt;- c(&quot;w.age&quot;, &quot;w.ed&quot;, &quot;h.ed&quot;, &quot;child&quot;, &quot;rel&quot;,&quot;w.occ&quot;, &quot;h.occ&quot;, &quot;ind&quot;, &quot;med&quot;, &quot;outcome&quot;) 
data$w.ed &lt;- as.factor(data$w.ed) 
data$h.ed &lt;- as.factor(data$h.ed) 
data$rel&lt;-as.factor(data$rel) 
data$w.occ &lt;- as.factor(data$w.occ) 
data$h.occ &lt;- as.factor(data$h.occ) 
data$ind &lt;- as.factor(data$ind) 
data$med &lt;- as.factor(data$med) 
data$outcome &lt;- as.factor(data$outcome) 
summary(data)</code></pre>
<pre><code>##      w.age       w.ed    h.ed        child        rel      w.occ   
##  Min.   :16.00   1:152   1: 44   Min.   : 0.000   0: 220   0: 369  
##  1st Qu.:26.00   2:334   2:178   1st Qu.: 1.000   1:1253   1:1104  
##  Median :32.00   3:410   3:352   Median : 3.000                    
##  Mean   :32.54   4:577   4:899   Mean   : 3.261                    
##  3rd Qu.:39.00                   3rd Qu.: 4.000                    
##  Max.   :49.00                   Max.   :16.000                    
##  h.occ   ind     med      outcome
##  1:436   1:129   0:1364   1:629  
##  2:425   2:229   1: 109   2:333  
##  3:585   3:431            3:511  
##  4: 27   4:684                   
##                                  
## </code></pre>
<p>As you can see, we have 3 classes in <code>outcome</code> variable, which means that we have to generate 3 different models to perform logistic regression on this data for each class.</p>
<p>Let’s subset the data into training and testing sets:</p>
<pre class="r"><code>data &lt;- data[sample(nrow(data)),] #Shuffles the data by sampling nrow(data) observations from the data without replacement 
trainInd &lt;- round(nrow(data)*0.7) #Take 70% of data as training 
train &lt;- data[1:trainInd,] #Subset training data 
test.outcome &lt;- data[-(1:trainInd),10] #Separate the outcome values of test 
test &lt;- data[-(1:trainInd),-10] #Subset test data and remove outcome variable</code></pre>
<p>If you like, you can separate the training test further into training and validation tests to see if your model is working properly.</p>
<p>In R, we can train logistic regression with a single line of code. <code>glm</code> function computes logistic regression using <code>family = binomial(&quot;logit&quot;)</code> parameter. This means that our output variable has a binomial distribution of <code>1s</code> and <code>0s</code>. If you want to classify more that two outcomes, you will need to use two combinatorials of those outcomes (one vs. all). This is what we will try to do.</p>
<pre class="r"><code>iris2 &lt;-iris 
iris2$Species&lt;-as.numeric(iris2$Species)
#Create dataset for setosa 
iris2.setosa &lt;-iris2 
iris2.setosa$Species &lt;- as.factor(iris2.setosa$Species==1)
#Create dataset for versicolor 
iris2.versicolor &lt;-iris2 
iris2.versicolor$Species &lt;- as.factor(iris2.versicolor$Species==2) 
#Create dataset for virginica 
iris2.virginica &lt;-iris2 
iris2.virginica$Species &lt;- as.factor(iris2.virginica$Species==3)
logit.setosa &lt;- glm(Species~., data = iris2.setosa, family = binomial)
summary(logit.setosa)</code></pre>
<pre><code>## 
## Call:
## glm(formula = Species ~ ., family = binomial, data = iris2.setosa)
## 
## Deviance Residuals: 
##        Min          1Q      Median          3Q         Max  
## -3.185e-05  -2.100e-08  -2.100e-08   2.100e-08   3.173e-05  
## 
## Coefficients:
##                Estimate Std. Error z value Pr(&gt;|z|)
## (Intercept)     -16.946 457457.097       0        1
## Sepal.Length     11.759 130504.042       0        1
## Sepal.Width       7.842  59415.385       0        1
## Petal.Length    -20.088 107724.594       0        1
## Petal.Width     -21.608 154350.616       0        1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 1.9095e+02  on 149  degrees of freedom
## Residual deviance: 3.2940e-09  on 145  degrees of freedom
## AIC: 10
## 
## Number of Fisher Scoring iterations: 25</code></pre>
<pre class="r"><code>class1.train &lt;- train 
class1.train$outcome &lt;- class1.train$outcome==1 #Get true for class = 1, false for otherwise 
class1.model &lt;- glm(outcome~., data = class1.train, family = binomial(&quot;logit&quot;)) 
summary(class1.model)</code></pre>
<pre><code>## 
## Call:
## glm(formula = outcome ~ ., family = binomial(&quot;logit&quot;), data = class1.train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.1213  -0.9526  -0.6348   1.0250   2.1675  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -0.40135    0.73874  -0.543  0.58694    
## w.age        0.08980    0.01188   7.561 4.00e-14 ***
## w.ed2       -0.37659    0.28467  -1.323  0.18586    
## w.ed3       -0.67792    0.29538  -2.295  0.02173 *  
## w.ed4       -1.64328    0.32056  -5.126 2.96e-07 ***
## h.ed2       -0.14905    0.48879  -0.305  0.76041    
## h.ed3       -0.45765    0.48198  -0.950  0.34235    
## h.ed4       -0.10720    0.48900  -0.219  0.82647    
## child       -0.36368    0.04313  -8.431  &lt; 2e-16 ***
## rel1         0.46206    0.21408   2.158  0.03090 *  
## w.occ1      -0.27739    0.16099  -1.723  0.08489 .  
## h.occ2       0.16536    0.20344   0.813  0.41632    
## h.occ3      -0.22046    0.20016  -1.101  0.27069    
## h.occ4      -0.08834    0.51030  -0.173  0.86256    
## ind2        -0.62794    0.29419  -2.134  0.03280 *  
## ind3        -0.76125    0.27930  -2.726  0.00642 ** 
## ind4        -0.91853    0.28440  -3.230  0.00124 ** 
## med1         0.63268    0.30279   2.089  0.03666 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 1409.9  on 1030  degrees of freedom
## Residual deviance: 1219.9  on 1013  degrees of freedom
## AIC: 1255.9
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>There are some irrelevant features in this model, so we can use stepwise removal to retain only relevant ones. There are other methods for variable selection which we will not cover in this tutorial.</p>
<pre class="r"><code>class1.model2 &lt;- step(class1.model, direction=&quot;backward&quot;, trace=0) 
summary(class1.model2)</code></pre>
<pre><code>## 
## Call:
## glm(formula = outcome ~ w.age + w.ed + child + rel + w.occ + 
##     ind + med, family = binomial(&quot;logit&quot;), data = class1.train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.0393  -0.9659  -0.6485   1.0278   2.1705  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -0.74819    0.52794  -1.417  0.15643    
## w.age        0.09059    0.01157   7.830 4.86e-15 ***
## w.ed2       -0.36677    0.27858  -1.317  0.18798    
## w.ed3       -0.65249    0.27447  -2.377  0.01744 *  
## w.ed4       -1.49724    0.28014  -5.345 9.06e-08 ***
## child       -0.36070    0.04222  -8.543  &lt; 2e-16 ***
## rel1         0.42267    0.20915   2.021  0.04329 *  
## w.occ1      -0.26370    0.15961  -1.652  0.09850 .  
## ind2        -0.63929    0.29227  -2.187  0.02872 *  
## ind3        -0.72959    0.27467  -2.656  0.00790 ** 
## ind4        -0.85178    0.27719  -3.073  0.00212 ** 
## med1         0.69557    0.30217   2.302  0.02134 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 1409.9  on 1030  degrees of freedom
## Residual deviance: 1229.1  on 1019  degrees of freedom
## AIC: 1253.1
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>After generating the model for outcome = 1, not we have to generate models for other outcome values.</p>
<p>For outcome = 2:</p>
<pre class="r"><code>class2.train &lt;- train 
class2.train$outcome &lt;- class2.train$outcome==2 #Get true for class = 1, false for otherwise 
class2.model &lt;- glm(outcome~., data = class2.train, family = binomial(&quot;logit&quot;)) 
summary(class2.model)</code></pre>
<pre><code>## 
## Call:
## glm(formula = outcome ~ ., family = binomial(&quot;logit&quot;), data = class2.train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.1074  -0.7423  -0.4900  -0.1971   2.6665  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -2.28647    0.92394  -2.475 0.013335 *  
## w.age       -0.00659    0.01352  -0.487 0.625932    
## w.ed2        1.47060    0.55343   2.657 0.007878 ** 
## w.ed3        1.87670    0.55568   3.377 0.000732 ***
## w.ed4        2.51796    0.56924   4.423 9.72e-06 ***
## h.ed2       -1.72658    0.60665  -2.846 0.004426 ** 
## h.ed3       -1.52049    0.56910  -2.672 0.007545 ** 
## h.ed4       -1.35151    0.56935  -2.374 0.017608 *  
## child        0.20791    0.04639   4.482 7.40e-06 ***
## rel1        -0.54606    0.21845  -2.500 0.012430 *  
## w.occ1       0.05085    0.19028   0.267 0.789304    
## h.occ2      -0.37319    0.22215  -1.680 0.092967 .  
## h.occ3      -0.33398    0.21638  -1.543 0.122712    
## h.occ4      -0.08114    0.68760  -0.118 0.906062    
## ind2         0.46175    0.48046   0.961 0.336524    
## ind3         0.48118    0.45866   1.049 0.294139    
## ind4         0.71069    0.46179   1.539 0.123802    
## med1        -0.16175    0.44724  -0.362 0.717609    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 1079.30  on 1030  degrees of freedom
## Residual deviance:  950.64  on 1013  degrees of freedom
## AIC: 986.64
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<pre class="r"><code>class2.model2 &lt;- step(class2.model, direction=&quot;backward&quot;, trace=0) 
summary(class2.model2)</code></pre>
<pre><code>## 
## Call:
## glm(formula = outcome ~ w.ed + h.ed + child + rel, family = binomial(&quot;logit&quot;), 
##     data = class2.train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.0376  -0.7430  -0.5119  -0.1948   2.7343  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -2.62307    0.65047  -4.033 5.52e-05 ***
## w.ed2        1.54182    0.53750   2.869 0.004124 ** 
## w.ed3        1.98236    0.53900   3.678 0.000235 ***
## w.ed4        2.77375    0.54717   5.069 3.99e-07 ***
## h.ed2       -1.58378    0.59862  -2.646 0.008152 ** 
## h.ed3       -1.28086    0.55318  -2.315 0.020588 *  
## h.ed4       -1.00399    0.54804  -1.832 0.066958 .  
## child        0.20588    0.03631   5.670 1.43e-08 ***
## rel1        -0.49878    0.20536  -2.429 0.015151 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 1079.30  on 1030  degrees of freedom
## Residual deviance:  958.97  on 1022  degrees of freedom
## AIC: 976.97
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p>For outcome = 3:</p>
<pre class="r"><code>class3.train &lt;- train 
class3.train$outcome &lt;- class3.train$outcome==3 #Get true for class = 1, false for otherwise 
class3.model &lt;- glm(outcome~., data = class3.train, family = binomial(&quot;logit&quot;)) 
summary(class3.model)</code></pre>
<pre><code>## 
## Call:
## glm(formula = outcome ~ ., family = binomial(&quot;logit&quot;), data = class3.train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.6760  -0.9414  -0.6353   1.1746   2.2517  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -0.84910    0.95146  -0.892   0.3722    
## w.age       -0.09471    0.01273  -7.441 9.99e-14 ***
## w.ed2       -0.15621    0.29332  -0.533   0.5943    
## w.ed3       -0.09551    0.30284  -0.315   0.7525    
## w.ed4        0.33030    0.32130   1.028   0.3039    
## h.ed2        1.67556    0.77244   2.169   0.0301 *  
## h.ed3        1.86040    0.76719   2.425   0.0153 *  
## h.ed4        1.48393    0.77193   1.922   0.0546 .  
## child        0.22516    0.04090   5.505 3.70e-08 ***
## rel1        -0.04928    0.21593  -0.228   0.8195    
## w.occ1       0.19347    0.16632   1.163   0.2447    
## h.occ2       0.17686    0.20420   0.866   0.3864    
## h.occ3       0.49636    0.19530   2.542   0.0110 *  
## h.occ4       0.14905    0.53532   0.278   0.7807    
## ind2         0.50442    0.30559   1.651   0.0988 .  
## ind3         0.64364    0.28801   2.235   0.0254 *  
## ind4         0.60720    0.29236   2.077   0.0378 *  
## med1        -0.58085    0.33039  -1.758   0.0787 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 1336.5  on 1030  degrees of freedom
## Residual deviance: 1217.6  on 1013  degrees of freedom
## AIC: 1253.6
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<pre class="r"><code>class3.model2 &lt;- step(class3.model, direction=&quot;backward&quot;, trace=0) 
summary(class3.model2)</code></pre>
<pre><code>## 
## Call:
## glm(formula = outcome ~ w.age + w.ed + h.ed + child + h.occ + 
##     med, family = binomial(&quot;logit&quot;), data = class3.train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.6036  -0.9560  -0.6591   1.1745   2.2415  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -0.42721    0.87005  -0.491  0.62341    
## w.age       -0.09245    0.01223  -7.560 4.03e-14 ***
## w.ed2       -0.16973    0.29064  -0.584  0.55922    
## w.ed3       -0.08862    0.29921  -0.296  0.76709    
## w.ed4        0.35851    0.31528   1.137  0.25549    
## h.ed2        1.76354    0.77061   2.289  0.02211 *  
## h.ed3        1.98567    0.76526   2.595  0.00947 ** 
## h.ed4        1.66250    0.76784   2.165  0.03037 *  
## child        0.23061    0.04008   5.753 8.76e-09 ***
## h.occ2       0.17156    0.20079   0.854  0.39288    
## h.occ3       0.47962    0.19167   2.502  0.01234 *  
## h.occ4       0.10643    0.52936   0.201  0.84066    
## med1        -0.67288    0.32344  -2.080  0.03749 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 1336.5  on 1030  degrees of freedom
## Residual deviance: 1224.1  on 1018  degrees of freedom
## AIC: 1250.1
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p>In these models, p-values show the significance level of the variables. The residual deviance and null deviance show the variability of the residuals and the model predictions respectively. We want them to be as small as possible. Coefficients explain the effect of that variable on the outcome.</p>
<p>Now that we have generated our models, we can perform classification with the test set we have set aside:</p>
<pre class="r"><code>class1.test &lt;- predict(class1.model2, test, type = &quot;response&quot;) #Predicts probability of belonging to that class 
class2.test &lt;- predict(class2.model2, test, type = &quot;response&quot;) 
class3.test &lt;- predict(class3.model2, test, type = &quot;response&quot;) 
classProbs &lt;- cbind(class1.test, class2.test, class3.test) 
classProbs &lt;- classProbs/rowSums(classProbs) 
tclassProbs &lt;- data.frame(t(classProbs)) 
classes &lt;- as.factor(sapply(tclassProbs, which.max)) 
confusionMatrix(classes, test.outcome)</code></pre>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction   1   2   3
##          1 112  40  55
##          2  11  33  17
##          3  61  36  77
## 
## Overall Statistics
##                                           
##                Accuracy : 0.5023          
##                  95% CI : (0.4546, 0.5499)
##     No Information Rate : 0.4163          
##     P-Value [Acc &gt; NIR] : 0.0001625       
##                                           
##                   Kappa : 0.2202          
##                                           
##  Mcnemar&#39;s Test P-Value : 3.01e-05        
## 
## Statistics by Class:
## 
##                      Class: 1 Class: 2 Class: 3
## Sensitivity            0.6087  0.30275   0.5168
## Specificity            0.6318  0.91592   0.6689
## Pos Pred Value         0.5411  0.54098   0.4425
## Neg Pred Value         0.6936  0.80052   0.7313
## Prevalence             0.4163  0.24661   0.3371
## Detection Rate         0.2534  0.07466   0.1742
## Detection Prevalence   0.4683  0.13801   0.3937
## Balanced Accuracy      0.6202  0.60933   0.5929</code></pre>
<p>This model obviously does not perform well. It can only predict the true class 50% of the time, which is better than chance level in this case because prediction true class out of 3 possible values has a chance value of 33% but still, 50% is not good. This process is also very difficult to do when working with more than 3 classes. With 4 classes, you need to generate 6 models. With 5 classes, you need to generate 10 models and with 10 classes you need to generate 45 models for classification. There are packages that do this for you but they are won’t be covered in this tutorial.</p>
<p>To evaluate a single logistic regression model, we can use the following code to get the p-value associated with it. Assume we want to test if class3.model2 is a viable model:</p>
<pre class="r"><code>with(class3.model2, pchisq(null.deviance - deviance, df.null - df.residual, lower.tail = FALSE))</code></pre>
<pre><code>## [1] 2.087345e-18</code></pre>
<p>The p-value is &lt;&lt;0.05, so the model is appropriate for use.</p>
<p>Suppose we want to see the probability and the confidence interval of beloging to that class by a random variable in the dataset for <code>class3.model2</code>, first we need to get the probabilities of that class along with the standard error of the prediction, then we plot it with the desired variable:</p>
<pre class="r"><code>newdata &lt;- cbind(test, predict(class3.model2, newdata = test, type = &quot;link&quot;,se = TRUE)) 
newdata &lt;- within(newdata, { 
  PredictedProb &lt;- plogis(fit) 
  LL &lt;- plogis(fit - (1.96 * se.fit)) 
  UL &lt;- plogis(fit + (1.96 * se.fit)) 
})</code></pre>
<p>Suppose we want to see how the probabilities change by <code>w.age</code>, the following code visualizes that relationship:</p>
<pre class="r"><code>ggplot(newdata, aes(x = w.age, y = PredictedProb)) + geom_ribbon(aes(ymin = LL,
                                                                     ymax = UL), alpha = 0.2) + geom_line(size = 1)</code></pre>
<p><img src="classification_files/figure-html/unnamed-chunk-19-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="support-vector-machines-svms" class="section level2">
<h2>Support Vector Machines (SVMs)</h2>
<p>SVMs can be used both for classification and regression. Luckily enough, you don’t have to explicitly perform one vs. all classification with SVMs. Even though SVMs perform one vs. all classification, they do this internally and we can simply use the <code>svm</code> function in <code>e1071</code> package. Let’s use the <code>iris</code> data set:</p>
<pre class="r"><code>svm.model &lt;- svm(Species~., data = trainIris) 
summary(svm.model)</code></pre>
<pre><code>## 
## Call:
## svm(formula = Species ~ ., data = trainIris)
## 
## 
## Parameters:
##    SVM-Type:  C-classification 
##  SVM-Kernel:  radial 
##        cost:  1 
## 
## Number of Support Vectors:  46
## 
##  ( 19 10 17 )
## 
## 
## Number of Classes:  3 
## 
## Levels: 
##  setosa versicolor virginica</code></pre>
<pre class="r"><code>svm.preds &lt;- predict(svm.model, testIris) 
confusionMatrix(svm.preds, testClass)</code></pre>
<pre><code>## Confusion Matrix and Statistics
## 
##             Reference
## Prediction   setosa versicolor virginica
##   setosa         20          0         0
##   versicolor      0         12         1
##   virginica       0          0        17
## 
## Overall Statistics
##                                           
##                Accuracy : 0.98            
##                  95% CI : (0.8935, 0.9995)
##     No Information Rate : 0.4             
##     P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
##                                           
##                   Kappa : 0.9695          
##                                           
##  Mcnemar&#39;s Test P-Value : NA              
## 
## Statistics by Class:
## 
##                      Class: setosa Class: versicolor Class: virginica
## Sensitivity                    1.0            1.0000           0.9444
## Specificity                    1.0            0.9737           1.0000
## Pos Pred Value                 1.0            0.9231           1.0000
## Neg Pred Value                 1.0            1.0000           0.9697
## Prevalence                     0.4            0.2400           0.3600
## Detection Rate                 0.4            0.2400           0.3400
## Detection Prevalence           0.4            0.2600           0.3400
## Balanced Accuracy              1.0            0.9868           0.9722</code></pre>
<p>SVM performed well on <code>iris</code> dataset with the accuracy of 94%.</p>
</div>
<div id="artificial-neural-networks-anns" class="section level2">
<h2>Artificial Neural Networks (ANNs)</h2>
<p>ANNs can also be used for both regression and classification.</p>
<pre class="r"><code>require(nnet)
nnet.model &lt;- nnet(outcome~., data = train, size = 25) #size defines hidden layer size</code></pre>
<pre><code>## # weights:  528
## initial  value 1181.407648 
## iter  10 value 1028.730958
## iter  20 value 951.407539
## iter  30 value 883.473186
## iter  40 value 851.508974
## iter  50 value 833.721168
## iter  60 value 811.078186
## iter  70 value 786.123375
## iter  80 value 765.984648
## iter  90 value 721.725697
## iter 100 value 690.586840
## final  value 690.586840 
## stopped after 100 iterations</code></pre>
<pre class="r"><code>print(nnet.model)</code></pre>
<pre><code>## a 17-25-3 network with 528 weights
## inputs: w.age w.ed2 w.ed3 w.ed4 h.ed2 h.ed3 h.ed4 child rel1 w.occ1 h.occ2 h.occ3 h.occ4 ind2 ind3 ind4 med1 
## output(s): outcome 
## options were - softmax modelling</code></pre>
<pre class="r"><code>nnet.preds &lt;- predict(nnet.model, test) #Returns class probabilities, so we should perform some data cleaning as we did in the logistic regression
nnet.preds &lt;- nnet.preds/rowSums(nnet.preds) 
tnnet.preds &lt;- data.frame(t(nnet.preds)) 
classes &lt;- as.factor(sapply(tnnet.preds, which.max)) 
levels(classes) &lt;- c(&quot;1&quot;,&quot;2&quot;,&quot;3&quot;) 
confusionMatrix(classes, test.outcome)</code></pre>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction  1  2  3
##          1 93 21 57
##          2 32 43 23
##          3 59 45 69
## 
## Overall Statistics
##                                           
##                Accuracy : 0.4638          
##                  95% CI : (0.4166, 0.5115)
##     No Information Rate : 0.4163          
##     P-Value [Acc &gt; NIR] : 0.02434         
##                                           
##                   Kappa : 0.178           
##                                           
##  Mcnemar&#39;s Test P-Value : 0.02403         
## 
## Statistics by Class:
## 
##                      Class: 1 Class: 2 Class: 3
## Sensitivity            0.5054  0.39450   0.4631
## Specificity            0.6977  0.83483   0.6451
## Pos Pred Value         0.5439  0.43878   0.3988
## Neg Pred Value         0.6642  0.80814   0.7026
## Prevalence             0.4163  0.24661   0.3371
## Detection Rate         0.2104  0.09729   0.1561
## Detection Prevalence   0.3869  0.22172   0.3914
## Balanced Accuracy      0.6016  0.61467   0.5541</code></pre>
<p>Neural Network performed on par with the logistic regression. However, neural network is very sensitive to hidden layer size. It is advised to use different sizes of hidden layers when generating neural network models.</p>
</div>
<div id="evaluation-measures" class="section level2">
<h2>Evaluation Measures</h2>
<p>There are several evaluation measures reported in the outputs of the models generated above. Three most important values are ?<em>Sensitivity</em>?, ?<em>Specificity</em>? and ?<em>Accuracy</em>?. Accuracy gives you which percent of the data you correctly classified. However this is not a good measure if there is a class unbalance. For instance, let?s say that you have 100 data points of which 95 are <code>class a</code> and 5 are <code>class b</code>. You can classify all 100 points as <code>class a</code> and you will still have 95% accuracy, even though you failed to find any data that belongs to <code>class b</code>. This is why we need sensitivity and specificity. Sensitivity tells us how many of the data that are of <code>class a</code>, we were able to classify as <code>class a</code>. In this example, this would be 1. Because every data that belonged to <code>class a</code> was classified as <code>class a</code>. Specificity tells us how many data points that were <code>class b</code> were classified as <code>class b</code>. In this example, specificity will be zero because none of the data that were <code>class b</code> was classified as such. Ideally, we want both of these values to be close to one. If all your values are close to one, then you have a good model.</p>
<div id="receiver-operating-characteristic-roc-curve-and-area-under-curve-auc" class="section level3">
<h3>Receiver Operating Characteristic (ROC) Curve and Area Under Curve (AUC)</h3>
<p>In a Receiver Operating Characteristic (ROC) curve the true positive rate (Sensitivity) is plotted in function of the false positive rate (100-Specificity) for different cut-off points. Each point on the ROC curve represents a sensitivity/specificity pair corresponding to a particular decision threshold. A test with perfect discrimination (no overlap in the two distributions) has a ROC curve that passes through the upper left corner (100% sensitivity, 100% specificity). Therefore the closer the ROC curve is to the upper left corner, the higher the overall accuracy of the test.</p>
<p>Let’s plot ROC curve of the <code>class3.model2</code> that we fit with logistic regression:</p>
<pre class="r"><code>#install.packages(pROC)
class3probs&lt;-predict(class3.model2,type=&quot;response&quot;)
require(pROC)
roccurve &lt;- roc(class3.model2$y, class3probs)
plot(roccurve)</code></pre>
<p><img src="classification_files/figure-html/unnamed-chunk-25-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>auc(roccurve)</code></pre>
<pre><code>## Area under the curve: 0.6864</code></pre>
<p>We want that curve to be far away from straight line. Ideally we want the area under the curve as high as possible. We want to make almost 0% mistakes while identifying all the positives, which means we want to see AUC value near to 1.</p>
<p>As can be seen, the AUC for logistic regression model of class 3 is 0.66. It is a fairly good model but it can be enhanced.</p>
</div>
</div>
<div id="useful-links" class="section level2">
<h2>Useful Links</h2>
<ul>
<li>Caret package documentation: <a href="http://www.jstatsoft.org/v28/i05/paper" class="uri">http://www.jstatsoft.org/v28/i05/paper</a>
<ul>
<li>This webpage holds examples and advanced methods for generating both classification and regression models using <code>caret</code> package.</li>
</ul></li>
<li>Accurately determining prediction error: <a href="http://scott.fortmann-roe.com/docs/MeasuringError.html" class="uri">http://scott.fortmann-roe.com/docs/MeasuringError.html</a>
<ul>
<li>This document explains the details of error measurements</li>
</ul></li>
<li>Multinomial logit model website: <a href="http://cran.r-project.org/web/packages/mlogit/vignettes/mlogit.pdf" class="uri">http://cran.r-project.org/web/packages/mlogit/vignettes/mlogit.pdf</a>
<ul>
<li>This website contains examples and usage details of the <code>mlogit</code> package</li>
</ul></li>
</ul>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
